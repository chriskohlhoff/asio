ifndef BOOSTDIR
BOOSTDIR = ../../boost_1_32_0
endif

CXXFLAGS = -g -O3 -Wall -mthreads -I../include -I$(BOOSTDIR)
LDFLAGS = -g -O3 -mthreads
LIBS = -lws2_32

TEST_EXES = \
	tests/performance/client.exe \
	tests/performance/server.exe \
	tests/unit/demuxer_test.exe \
	tests/unit/datagram_socket_test.exe \
	tests/unit/error_handler_test.exe \
	tests/unit/fixed_buffer_test.exe \
	tests/unit/ipv4_host_resolver_test.exe \
	tests/unit/is_read_buffered_test.exe \
	tests/unit/is_write_buffered_test.exe \
	tests/unit/locking_dispatcher_test.exe \
	tests/unit/read_test.exe \
	tests/unit/write_test.exe \
	tests/unit/socket_acceptor_test.exe \
	tests/unit/timer_test.exe

EXAMPLE_EXES = \
	examples/chat/chat_client.exe \
	examples/chat/chat_server.exe \
	examples/echo/async_tcp_echo_server.exe \
	examples/echo/async_udp_echo_server.exe \
	examples/echo/blocking_tcp_echo_client.exe \
	examples/echo/blocking_tcp_echo_server.exe \
	examples/echo/blocking_udp_echo_client.exe \
	examples/echo/blocking_udp_echo_server.exe \
	examples/multicast/receiver.exe \
	examples/multicast/sender.exe \
	examples/timeouts/accept_timeout.exe \
	examples/timeouts/connect_timeout.exe \
	examples/timeouts/datagram_receive_timeout.exe \
	examples/timeouts/stream_recv_timeout.exe \
	examples/tutorial/timer1/timer.exe \
	examples/tutorial/timer2/timer.exe \
	examples/tutorial/timer3/timer.exe \
	examples/tutorial/timer4/timer.exe \
	examples/tutorial/timer5/timer.exe \
	examples/tutorial/daytime1/client.exe \
	examples/tutorial/daytime2/server.exe \
	examples/tutorial/daytime3/server.exe \
	examples/tutorial/daytime4/client.exe \
	examples/tutorial/daytime5/server.exe \
	examples/tutorial/daytime6/server.exe \
	examples/tutorial/daytime7/server.exe

all: $(TEST_EXES) $(EXAMPLE_EXES)

clean:
	-rm -f $(TEST_EXES)
	-rm -f $(TEST_EXES:.exe=.o)
	-rm -f $(EXAMPLE_EXES)
	-rm -f $(EXAMPLE_EXES:.exe=.o)

$(TEST_EXES) $(EXAMPLE_EXES): %.exe: %.o
	g++ -o$@ $(LDFLAGS) $< $(LIBS)

.cpp.o:
	g++ -o$@ -c $(CXXFLAGS) $<
